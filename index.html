<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game Hub｜スライム育成 & マイクラ風じゃんけん</title>
<!-- TailwindはじゃんけんUIで使用（他の見た目は自前CSS） -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* ====== 共通レイアウト（メニュー/ヘッダー） ====== */
  :root{
    --ink:#0f172a;
    --paper:#f8fafc;
    --accent:#60a5fa;
    --accent-2:#34d399;
    --border:#111827;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100svh; background:linear-gradient(#e6f0ff, #e6f0ff 60%, #dbeafe);
    font-family: ui-rounded, system-ui, -apple-system, "Segoe UI","Hiragino Kaku Gothic ProN","Noto Sans JP", sans-serif;
    color:var(--ink);
  }
  .app{display:flex;flex-direction:column;min-height:100svh}
  .topbar{
    display:flex;align-items:center;gap:12px;
    padding:10px 14px;border-bottom:3px solid var(--border);
    background:#fff;position:sticky;top:0;z-index:1000;
  }
  .homebtn{
    font-weight:900;border:3px solid var(--border);border-radius:10px;background:#fff;
    padding:8px 12px;cursor:pointer;box-shadow:4px 4px 0 rgba(0,0,0,.2), inset 3px 3px 0 rgba(255,255,255,.65);
  }
  .brand{font-weight:900;font-size:clamp(16px,2.6vw,22px)}
  .screen{display:none;padding:18px}
  .screen.active{display:block}
  /* ====== メニュー画面 ====== */
  .menu-wrap{max-width:1100px;margin-inline:auto}
  .cards{display:grid;grid-template-columns:1fr;gap:16px}
  @media (min-width:860px){ .cards{grid-template-columns:1fr 1fr} }
  .card{
    background:#fff;border:4px solid #111827;border-radius:16px;
    box-shadow:8px 8px 0 rgba(0,0,0,.25),inset 4px 4px 0 rgba(255,255,255,.6);
    padding:18px;display:flex;flex-direction:column;gap:10px;
  }
  .card h2{margin:0;font-size:clamp(18px,2.4vw,24px)}
  .play{
    margin-top:auto;align-self:flex-start;font-weight:900;border:3px solid #111827;border-radius:10px;
    padding:10px 14px;cursor:pointer;background:linear-gradient(#fff,#f3f6ff);
    box-shadow:4px 4px 0 rgba(0,0,0,.2), inset 3px 3px 0 rgba(255,255,255,.65);
  }
  .tags{display:flex;flex-wrap:wrap;gap:8px}
  .tag{border:3px solid #111827;border-radius:999px;padding:4px 10px;background:#fff;font-weight:800}

  /* ====== スライム育成：見た目（元ゲームを .slime-root にスコープ） ====== */
  .slime-root{
    margin-inline:auto;width:min(860px,96vw);
    background:#f7f7fb;border:4px solid #3d3d3d;border-radius:16px;
    box-shadow:8px 8px 0 rgba(0,0,0,.25), inset 4px 4px 0 rgba(255,255,255,.5);
    padding:16px;
    background-image:none;
  }
  .slime-stage{
    position:relative;border:4px solid #3d3d3d;border-radius:12px;
    background: radial-gradient(ellipse at 50% 20%, rgba(255,255,255,.6), transparent 60%);
    height:280px;overflow:hidden;
  }
  .slime-root.night .slime-stage{
    background: radial-gradient(ellipse at 50% 20%, rgba(255,255,255,.12), transparent 60%);
  }
  .sun,.moon{position:absolute;top:18px;right:18px;width:42px;height:42px;border-radius:50%;box-shadow:0 0 20px rgba(255,255,255,.4)}
  .sun{background:#ffe08a}.slime-root.night .sun{display:none}
  .moon{display:none;background:#eaefff}.slime-root.night .moon{display:block}
  .slime{
    --slime:#5bd1ff; position:absolute;left:50%;bottom:20px;transform:translateX(-50%);
    width:180px;height:140px;border-radius:120px 120px 60px 60px;border:4px solid #2b6aa8;
    background: radial-gradient(ellipse at 40% 30%, rgba(255,255,255,.7), rgba(255,255,255,0) 50%), var(--slime);
    box-shadow:0 8px 0 rgba(0,0,0,.2) inset; transition:transform .2s ease, background .3s ease;
  }
  .slime.face::after{
    content:"●   ●\A  ＿";white-space:pre;font-weight:700;line-height:1.2;color:#1b1b1b;
    position:absolute;top:38%;left:50%;transform:translateX(-50%);text-align:center;font-size:22px;
  }
  .slime.sleep::after{content:"-   -\A  ω"}
  .bubble{position:absolute;left:50%;top:18px;transform:translateX(-50%);background:#fff;color:#222;border:3px solid #333;border-radius:8px;
    padding:8px 12px;font-weight:700;box-shadow:4px 4px 0 rgba(0,0,0,.25);opacity:0;transition:opacity .25s ease;pointer-events:none}
  .bubble.show{opacity:1}
  .pause-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,.35);color:#fff;font-weight:900;font-size:clamp(18px,3vw,28px);
    border:3px solid #333;backdrop-filter:blur(2px);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:5}
  .pause-overlay.show{opacity:1}
  .stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0 6px}
  @media(min-width:780px){.stats{grid-template-columns:repeat(4,1fr)}}
  .meter{background:#f0f2ff;border:3px solid #3d3d3d;border-radius:8px;padding:6px 8px}
  .meter h3{margin:0 0 4px;font-size:14px;color:#222;display:flex;justify-content:space-between;align-items:center}
  .bar{background:#e5e7ff;height:14px;border:2px solid #3d3d3d;border-radius:6px;overflow:hidden}
  .fill{height:100%;width:50%;background:linear-gradient(90deg,#84d8ff,#2ea0ff);transition:width .2s ease}
  .fill.ok{background:linear-gradient(90deg,#86efac,#22c55e)}
  .fill.warn{background:linear-gradient(90deg,#fde68a,#f59e0b)}
  .fill.bad{background:linear-gradient(90deg,#fca5a5,#ef4444)}
  .controls{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(min-width:780px){.controls{grid-template-columns:repeat(6,1fr)}}
  .btn{font-weight:900;border:3px solid #3d3d3d;border-radius:10px;background:#fff;color:#111;padding:12px 10px;cursor:pointer;
    box-shadow:4px 4px 0 rgba(0,0,0,.25), inset 3px 3px 0 rgba(255,255,255,.65)}
  .btn:active{transform:translateY(2px);filter:brightness(.9)}
  .btn.primary{background:linear-gradient(#fff,#f2f6ff)}
  .btn.sleeping{background:#dbeafe}
  .btn.danger{background:#fee2e2;color:#7f1d1d}
  .btn:disabled{opacity:.6;cursor:not-allowed;filter:grayscale(.2)}
  .footer{display:flex;gap:10px;flex-wrap:wrap;padding-top:10px;color:#333}
  .chip{border:3px solid #3d3d3d;border-radius:10px;background:#fff;padding:8px 10px;box-shadow:inset 3px 3px 0 rgba(255,255,255,.65);font-weight:800}
  .note{margin-top:10px;font-size:13px;color:#333}

  /* ====== じゃんけん：見た目（元ゲームを .janken-root にスコープ） ====== */
  .janken-root{
    position:relative;min-height:calc(100svh - 70px);
    display:flex;justify-content:center;align-items:center;padding:20px;overflow:hidden;
  }
  .janken-root.biome-plain{background:linear-gradient(#78a7ff 60%,#559144 40%)}
  .janken-root.biome-forest{
    background:
      radial-gradient(circle at 10% 90%,#2f5f2f 1%,transparent 2%),
      radial-gradient(circle at 50% 80%,#3a753a 1%,transparent 2%),
      radial-gradient(circle at 90% 85%,#2f5f2f 1%,transparent 2%),
      linear-gradient(#4a7c2d 60%,#2f5220 40%);
    background-size:200px 200px;
  }
  .janken-root.biome-darkforest{
    background:
      radial-gradient(circle at 20% 85%,#203c20 1%,transparent 2%),
      radial-gradient(circle at 70% 90%,#1c301c 1%,transparent 2%),
      radial-gradient(circle at 90% 80%,#243a24 1%,transparent 2%),
      linear-gradient(#1f3c1a 60%,#14250e 40%);
    background-size:150px 150px;
  }
  .janken-root.biome-mushroom{
    background:
      radial-gradient(circle at 30% 85%,#c04ba3 1.5%,transparent 2%),
      radial-gradient(circle at 70% 90%,#b35fbd 1.5%,transparent 2%),
      linear-gradient(#8a55a3 60%,#4a2b7f 40%);
    background-size:250px 250px;
  }
  .janken-root.biome-snow{
    background:
      radial-gradient(circle at 10% 80%,#ffffff .5%,transparent 1.5%),
      radial-gradient(circle at 50% 85%,#ffffff .5%,transparent 1.5%),
      radial-gradient(circle at 90% 90%,#ffffff .5%,transparent 1.5%),
      linear-gradient(#b0d0ff 60%,#e6f3ff 40%);
    background-size:250px 250px;
  }
  .janken-root.theme-night::before{
    content:"";position:absolute;inset:0;z-index:2;pointer-events:none;
    background:
      radial-gradient(1px 1px at 20% 10%,#fff 70%,transparent 71%),
      radial-gradient(1px 1px at 35% 25%,#dfe8ff 70%,transparent 71%),
      radial-gradient(1px 1px at 55% 15%,#fff 70%,transparent 71%),
      radial-gradient(1px 1px at 80% 30%,#eaf1ff 70%,transparent 71%),
      radial-gradient(1px 1px at 10% 35%,#fff 70%,transparent 71%),
      radial-gradient(1px 1px at 70% 12%,#fff 70%,transparent 71%);
    opacity:.8;
  }
  .night-dim{position:absolute;inset:0;pointer-events:none;z-index:1;background:radial-gradient(circle at 50% 20%,rgba(0,0,0,.22) 0 45%,rgba(0,0,0,.35) 70%,rgba(0,0,0,.45) 100%)}
  @keyframes moon-float{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-4px) rotate(.6deg)}100%{transform:translateY(0) rotate(0)}}
  .moon{
    position:absolute;top:8%;right:6%;width:84px;height:84px;border-radius:50%;z-index:3;pointer-events:auto;cursor:pointer;animation:moon-float 6s ease-in-out infinite;
    background:
      radial-gradient(circle at 35% 35%,rgba(255,255,255,.9) 0 24%,rgba(255,255,255,0) 25%),
      radial-gradient(circle at 65% 55%,rgba(255,255,255,.8) 0 18%,rgba(255,255,255,0) 19%),
      radial-gradient(circle at 55% 25%,rgba(255,255,255,.7) 0 10%,rgba(255,255,255,0) 11%),
      radial-gradient(circle at 70% 30%,rgba(255,255,255,.5) 0 8%,rgba(255,255,255,0) 9%),
      radial-gradient(circle,#f7f7fb 0,#e6e9f5 60%,#cfd6ee 100%);
    box-shadow:0 0 18px 6px rgba(255,255,255,.25),0 0 40px 10px rgba(210,220,255,.15);
  }
  .moon::before{content:"";position:absolute;inset:0;border-radius:50%;background:rgba(0,0,20,.88);
    transform:translateX(var(--cover-x,0)) scaleX(var(--cover-scale,1));transition:transform .35s ease}
  .moon--new{opacity:.25}.moon--crescent{--cover-x:-22px;--cover-scale:1.08}.moon--half{--cover-x:0;--cover-scale:1}
  .moon--gibbous{--cover-x:18px;--cover-scale:.55}.moon--full{--cover-scale:0}
  .minecraft-box{position:relative;z-index:10;background:#f0f0f0;border-radius:0;border:4px solid #3d3d3d;box-shadow:8px 8px 0 rgba(0,0,0,.5),inset 4px 4px 0 rgba(255,255,255,.3)}
  .minecraft-button{border-radius:0;border:2px solid #3d3d3d;box-shadow:inset -4px -4px 0 rgba(0,0,0,.5),inset 4px 4px 0 rgba(255,255,255,.5)}
  .minecraft-button:active{transform:translateY(2px);filter:brightness(.8);box-shadow:inset 4px 4px 0 rgba(0,0,0,.5),inset -4px 4px 0 rgba(255,255,255,.5)}
  #j_effect{position:absolute;inset:0;overflow:hidden;pointer-events:none;z-index:50}
  @keyframes potion-pop{0%{transform:scale(0);opacity:1}100%{transform:scale(3);opacity:0}}
  .potion-effect{position:absolute;top:50%;left:50%;width:50px;height:50px;background:#ff00ff;animation:potion-pop .8s ease-out forwards;transform:translate(-50%,-50%);pointer-events:none;z-index:100}
  @keyframes explosion-flash{0%{background:transparent}20%{background:#ffe53c}40%{background:#ffb73c}60%{background:#ffe53c}80%{background:#ffb73c}100%{background:transparent}}
  .explosion-effect{position:absolute;inset:0;animation:explosion-flash .5s ease-out forwards;pointer-events:none;z-index:90}
  .snowflake{position:absolute;top:-10px;color:#fff;font-size:12px;opacity:.8;animation:fall linear infinite;pointer-events:none;z-index:5}
  @keyframes fall{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(100%) rotate(360deg)}}
  .biome-banner{position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:200;background:rgba(0,0,0,.7);color:#fff;padding:10px 20px;border:2px solid #fff;font-size:1.1rem;animation:fade-banner 2.5s ease-in-out forwards}
  @keyframes fade-banner{0%{opacity:0;transform:translate(-50%,-20px)}20%{opacity:1;transform:translate(-50%,0)}80%{opacity:1}100%{opacity:0;transform:translate(-50%,-20px)}}
  .janken-fab{position:absolute;left:16px;bottom:16px;z-index:350;background:#e5e7eb;padding:.6rem .9rem;font-size:.9rem}
  .credits-panel{position:absolute;left:16px;bottom:16px;z-index:360;width:320px;max-height:48vh;background:#111;color:#b7ffb7;border:4px solid #3d3d3d;border-radius:0;
    box-shadow:8px 8px 0 rgba(0,0,0,.6),inset 4px 4px 0 rgba(255,255,255,.06);transform:translateY(calc(100% + 16px));transition:transform .35s ease;display:flex;flex-direction:column}
  .credits-panel.open{transform:translateY(0)}
  .credits-header{background:#1b1b1b;color:#fff;border-bottom:2px solid #333;padding:.45rem .6rem;display:flex;justify-content:space-between;align-items:center;font-weight:700}
  .credits-close{background:#333;color:#fff;border:2px solid #555;padding:.15rem .5rem;cursor:pointer}
  .credits-log{padding:.6rem;font-family:ui-monospace,Menlo,Consolas,monospace;white-space:pre-wrap;overflow:auto;flex:1;line-height:1.35;background:#0b0f0b;border-top:2px solid #0c120c}
  .log-line{margin:0 0 .25rem}
  .cursor{display:inline-block;margin-left:2px;animation:blink 1s steps(1) infinite}
  @keyframes blink{50%{opacity:0}}
  @media(max-width:639px){
    .moon{width:56px;height:56px;top:6%;right:5%}
    .credits-panel{width:calc(100vw - 32px);max-height:60vh}
  }
</style>
</head>
<body>
<div class="app">
  <!-- ヘッダー（各ゲーム画面で表示、メニューでは透明） -->
  <div id="topbar" class="topbar" style="display:none">
    <button class="homebtn" id="btnHome" title="メニューに戻る">🏠 メニュー</button>
    <div class="brand" id="brandTitle">Game Hub</div>
  </div>

  <!-- 1) メニュー画面 -->
  <section id="screenMenu" class="screen active">
    <div class="menu-wrap">
      <h1 style="margin:8px 0 14px;font-size:clamp(22px,3vw,32px);text-align:center">🎮 Game Hub – 遊ぶためのちゃっと</h1>
      <div class="cards">
        <article class="card">
          <h2>ピクセルペット ☆ スライム育成</h2>
          <p>ボタンでお世話して、元気にそだてよう。昼夜が切り替わり、レベルで見た目も進化。</p>
          <div class="tags">
            <span class="tag">育成</span><span class="tag">ポーズ</span><span class="tag">オートセーブ</span>
          </div>
          <button id="playSlime" class="play">▶ はじめる</button>
        </article>

        <article class="card">
          <h2>⛏️ ブロック・じゃんけん！</h2>
          <p>マイクラ風の世界でCPUと勝負！勝つたびにバイオームが進み、夜には月も満ち欠け。</p>
          <div class="tags">
            <span class="tag">アクション</span><span class="tag">エフェクト</span><span class="tag">ナイト</span>
          </div>
          <button id="playJanken" class="play">▶ はじめる</button>
        </article>
      </div>
    </div>
  </section>

  <!-- 2) スライム育成 画面 -->
  <section id="screenSlime" class="screen">
    <div class="slime-root" id="slimeRoot">
      <h1 style="margin:0 0 10px 0;text-align:center;">ピクセルペット ☆ スライム育成</h1>
      <section class="slime-stage" aria-label="ステージ">
        <div class="sun" aria-hidden="true"></div>
        <div class="moon" aria-hidden="true"></div>
        <div id="slimeChar" class="slime face" role="img" aria-label="スライム"></div>
        <div id="slimeBubble" class="bubble" aria-live="polite">こんにちは！</div>
        <div id="slimePauseOverlay" class="pause-overlay" aria-hidden="true">⏸ 一時停止中</div>
      </section>

      <section class="stats">
        <div class="meter"><h3><span>おなか</span><span id="s-v-hunger">--</span></h3><div class="bar"><div id="s-bar-hunger" class="fill"></div></div></div>
        <div class="meter"><h3><span>げんき</span><span id="s-v-energy">--</span></h3><div class="bar"><div id="s-bar-energy" class="fill"></div></div></div>
        <div class="meter"><h3><span>きれい</span><span id="s-v-clean">--</span></h3><div class="bar"><div id="s-bar-clean" class="fill"></div></div></div>
        <div class="meter"><h3><span>ごきげん</span><span id="s-v-fun">--</span></h3><div class="bar"><div id="s-bar-fun" class="fill"></div></div></div>
      </section>

      <section class="controls">
        <button id="s-btn-feed"  class="btn primary">🍽 ごはん</button>
        <button id="s-btn-play"  class="btn primary">🎲 あそぶ</button>
        <button id="s-btn-bath"  class="btn primary">🫧 おふろ</button>
        <button id="s-btn-sleep" class="btn primary">😴 ねる</button>
        <button id="s-btn-med"   class="btn danger">💊 おくすり</button>
        <button id="s-btn-pause" class="btn">⏸ 一時停止</button>
      </section>

      <section class="footer">
        <div class="chip">レベル <span id="s-v-level">1</span></div>
        <div class="chip">けいけんち <span id="s-v-xp">0</span>/<span id="s-v-next">30</span></div>
        <div class="chip">モード：<span id="s-v-mode">昼</span></div>
      </section>

      <p class="note">
        あそびかた：メーターを高く保つとレベルアップ！夜と昼は自動で切り替わります。<br>
        ⏸で一時停止できます（セーブは自動）。
      </p>
    </div>
  </section>

  <!-- 3) マイクラ風じゃんけん 画面 -->
  <section id="screenJanken" class="screen">
    <div id="jankenRoot" class="janken-root biome-plain">
      <!-- 月＆減光などもこの中に生成 -->
      <div id="j_game" class="minecraft-box p-6 md:p-8 w-full max-w-lg">
        <div id="j_effect"></div>
        <h1 class="text-3xl font-bold text-center mb-4 text-gray-800 border-b-4 border-gray-800 pb-2">⛏️ ブロック・じゃんけん！ ⛏️</h1>

        <div class="flex justify-around items-center mb-4 bg-gray-700 p-4 minecraft-box text-white">
          <div class="text-center"><p class="text-lg font-bold">プレイヤー</p><p id="j-playerScore" class="text-4xl text-green-400">0</p></div>
          <p class="text-2xl mx-4">VS</p>
          <div class="text-center"><p class="text-lg font-bold">CPU (クリーパー)</p><p id="j-cpuScore" class="text-4xl text-red-400">0</p></div>
        </div>

        <div class="text-center mb-4 bg-gray-200 p-2 border-2 border-gray-500">
          <p class="text-lg font-bold text-gray-800">勝率 (Win Rate)</p>
          <p id="j-winRate" class="text-2xl font-black text-gray-700">0.00%</p>
        </div>

        <div class="text-center mb-4 p-4 border-4 border-dashed border-gray-500">
          <p id="j-resultText" class="text-2xl font-bold h-8 text-gray-900">あなたの手を選んでください！</p>
          <div class="flex justify-around mt-4">
            <div><p class="text-lg text-gray-600">あなた</p><p id="j-playerHand" class="text-4xl text-blue-600">?</p></div>
            <div><p class="text-lg text-gray-600">CPU</p><p id="j-cpuHand" class="text-4xl text-red-600">?</p></div>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-3 mb-4 sm:grid-cols-3">
          <button id="j-btn-rock"     class="minecraft-button bg-red-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">グー</button>
          <button id="j-btn-scissors" class="minecraft-button bg-green-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">チョキ</button>
          <button id="j-btn-paper"    class="minecraft-button bg-blue-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">パー</button>
        </div>

        <div class="flex items-center justify-between gap-3">
          <button id="j-btn-reset" class="minecraft-button w-full bg-yellow-400 text-gray-900 font-bold py-3 text-lg">スコアをリセット</button>
          <button id="j-btn-night" class="minecraft-button bg-gray-300 px-4 py-3 text-sm">🌙 / ☀ 切替</button>
        </div>
      </div>

      <!-- 📜クレジット（このroot内に固定配置） -->
      <button id="j-btn-credits" class="minecraft-button janken-fab">📜 クレジット</button>
      <div id="j-credits" class="credits-panel" aria-hidden="true" role="dialog" aria-label="スタッフロール">
        <div class="credits-header">
          <span>STAFF ROLL / LOG</span>
          <button id="j-btn-credits-close" class="credits-close" aria-label="閉じる">×</button>
        </div>
        <div id="j-credits-log" class="credits-log" aria-live="polite"></div>
      </div>
    </div>
  </section>
</div>

<script>
"use strict";

/* ==========================================================
   画面遷移（メニュー ⇄ 各ゲーム）
   ========================================================== */
const elTopbar = document.getElementById("topbar");
const elBtnHome = document.getElementById("btnHome");
const elBrand   = document.getElementById("brandTitle");
const screenMenu   = document.getElementById("screenMenu");
const screenSlime  = document.getElementById("screenSlime");
const screenJanken = document.getElementById("screenJanken");
const btnPlaySlime = document.getElementById("playSlime");
const btnPlayJanken= document.getElementById("playJanken");

let currentScreen = "menu";

function showMenu(){
  currentScreen="menu";
  screenMenu.classList.add("active");
  screenSlime.classList.remove("active");
  screenJanken.classList.remove("active");
  elTopbar.style.display="none";
}

function showSlime(){
  currentScreen="slime";
  screenMenu.classList.remove("active");
  screenJanken.classList.remove("active");
  screenSlime.classList.add("active");
  elTopbar.style.display="flex";
  elBrand.textContent="スライム育成";
  slime_onEnter();
}
function showJanken(){
  currentScreen="janken";
  screenMenu.classList.remove("active");
  screenSlime.classList.remove("active");
  screenJanken.classList.add("active");
  elTopbar.style.display="flex";
  elBrand.textContent="ブロック・じゃんけん！";
  janken_onEnter();
}

function onHomeClick(){
  if(currentScreen==="slime"){ slime_onLeave(); }
  if(currentScreen==="janken"){ janken_onLeave(); }
  showMenu();
}
function onMenuPlaySlime(){ showSlime(); }
function onMenuPlayJanken(){ showJanken(); }

elBtnHome.addEventListener("click", onHomeClick);
btnPlaySlime.addEventListener("click", onMenuPlaySlime);
btnPlayJanken.addEventListener("click", onMenuPlayJanken);

/* ==========================================================
   スライム育成（ポーズ付き）  —— すべて s- 接頭辞
   ========================================================== */
const SLIME_SAVE_KEY = "pixelpet_slime_v2_pause";
const slime_state = {
  hunger:70, energy:70, clean:70, fun:70,
  level:1, xp:0, nextXP:30,
  sleeping:false, isNight:false, paused:false, tick:0
};
let slime_loopId = 0;
let slime_talkTimer = 0;
let slime_started = false;

function s_byId(id){ return document.getElementById(id); }
function s_vibrate(ms){ if(navigator.vibrate){ navigator.vibrate(ms); } }
function s_clamp100(v){ if(v<0)return 0; if(v>100)return 100; return v; }

function slime_renderBars(){
  s_updateBar("hunger", slime_state.hunger);
  s_updateBar("energy", slime_state.energy);
  s_updateBar("clean",  slime_state.clean);
  s_updateBar("fun",    slime_state.fun);
}
function s_updateBar(kind,val){
  const fill = s_byId("s-bar-"+kind), text = s_byId("s-v-"+kind);
  fill.style.width = String(val)+"%"; text.textContent = Math.round(val);
  fill.classList.remove("ok","warn","bad");
  if(val>=60) fill.classList.add("ok"); else if(val>=30) fill.classList.add("warn"); else fill.classList.add("bad");
}
function slime_renderLevel(){
  s_byId("s-v-level").textContent = slime_state.level;
  s_byId("s-v-xp").textContent    = slime_state.xp;
  s_byId("s-v-next").textContent  = slime_state.nextXP;
}
function slime_renderDayNight(){
  const root = document.getElementById("slimeRoot");
  const txt  = s_byId("s-v-mode");
  if(slime_state.isNight){ root.classList.add("night"); txt.textContent="夜"; }
  else{ root.classList.remove("night"); txt.textContent="昼"; }
}
function slime_renderSlime(){
  const slime = s_byId("slimeChar");
  if(slime_state.sleeping){ slime.classList.add("sleep"); slime.classList.remove("face"); }
  else{ slime.classList.add("face"); slime.classList.remove("sleep"); }
  if(slime_state.level>=10){ slime.style.width="240px"; slime.style.height="180px"; slime.style.setProperty("--slime","#7effaf");}
  else if(slime_state.level>=5){ slime.style.width="210px"; slime.style.height="160px"; slime.style.setProperty("--slime","#7fb8ff");}
  else{ slime.style.width="180px"; slime.style.height="140px"; slime.style.setProperty("--slime","#5bd1ff");}
}
function slime_say(msg){
  const b = s_byId("slimeBubble");
  b.textContent=msg; b.classList.add("show");
  if(slime_talkTimer){ clearTimeout(slime_talkTimer); }
  slime_talkTimer = setTimeout(slime_hideBubble, 1800);
}
function slime_hideBubble(){ s_byId("slimeBubble").classList.remove("show"); }

function slime_onClickFeed(){
  if(slime_state.paused)return;
  slime_state.hunger=s_clamp100(slime_state.hunger+22);
  slime_state.energy=s_clamp100(slime_state.energy+6);
  slime_state.clean =s_clamp100(slime_state.clean -6);
  slime_gainXP(6); slime_renderBars(); slime_say("もぐもぐ！おいしい～"); s_vibrate(15); slime_save();
}
function slime_onClickPlay(){
  if(slime_state.paused)return;
  slime_state.fun   =s_clamp100(slime_state.fun+20);
  slime_state.energy=s_clamp100(slime_state.energy-10);
  slime_state.clean =s_clamp100(slime_state.clean-6);
  slime_gainXP(6); slime_renderBars(); slime_say("わーい！たのしい！"); s_vibrate(20); slime_save();
}
function slime_onClickBath(){
  if(slime_state.paused)return;
  slime_state.clean =s_clamp100(slime_state.clean+26);
  slime_state.fun   =s_clamp100(slime_state.fun+8);
  slime_state.energy=s_clamp100(slime_state.energy-6);
  slime_gainXP(5); slime_renderBars(); slime_say("ピカピカになったよ！"); s_vibrate(10); slime_save();
}
function slime_onClickSleep(){
  if(slime_state.paused)return;
  slime_state.sleeping=!slime_state.sleeping;
  const btn=s_byId("s-btn-sleep");
  if(slime_state.sleeping){ btn.classList.add("sleeping"); btn.textContent="⏰ おきる"; slime_say("おやすみ…Zzz"); }
  else{ btn.classList.remove("sleeping"); btn.textContent="😴 ねる"; slime_say("おはよう！"); }
  slime_renderSlime(); s_vibrate(8); slime_save();
}
function slime_onClickMed(){
  if(slime_state.paused)return;
  if(slime_canUseMed()){
    slime_state.hunger=s_clamp100(slime_state.hunger+14);
    slime_state.energy=s_clamp100(slime_state.energy+14);
    slime_state.clean =s_clamp100(slime_state.clean +14);
    slime_state.fun   =s_clamp100(slime_state.fun   +14);
    slime_gainXP(4); slime_renderBars(); slime_say("げんきが出てきたよ！"); s_vibrate(10); slime_save();
  }else{ slime_say("まだだいじょうぶ！"); }
}
function slime_canUseMed(){
  return (slime_state.hunger<30 || slime_state.energy<30 || slime_state.clean<30 || slime_state.fun<30);
}
function slime_onClickPause(){
  slime_state.paused=!slime_state.paused;
  slime_updatePauseUI(); slime_save();
}
function slime_updatePauseUI(){
  const b=s_byId("s-btn-pause"); const ov=s_byId("slimePauseOverlay");
  if(slime_state.paused){ b.textContent="▶ 再開"; ov.classList.add("show"); ov.setAttribute("aria-hidden","false"); slime_say("ゲームを一時停止中"); }
  else{ b.textContent="⏸ 一時停止"; ov.classList.remove("show"); ov.setAttribute("aria-hidden","true"); slime_say("ゲームを再開！"); }
  slime_renderButtons();
}
function slime_renderButtons(){
  const bFeed=s_byId("s-btn-feed"), bPlay=s_byId("s-btn-play"), bBath=s_byId("s-btn-bath"),
        bSleep=s_byId("s-btn-sleep"), bMed=s_byId("s-btn-med");
  if(slime_state.paused){
    bFeed.disabled=bPlay.disabled=bBath.disabled=bSleep.disabled=bMed.disabled=true;
  }else{
    if(slime_state.sleeping){ bFeed.disabled=bPlay.disabled=bBath.disabled=true; }
    else { bFeed.disabled=bPlay.disabled=bBath.disabled=false; }
    bMed.disabled=!slime_canUseMed(); bSleep.disabled=false;
  }
}

function slime_updateSecond(){
  if(slime_state.paused)return;
  slime_state.tick+=1;
  if(slime_state.sleeping){
    slime_state.energy=s_clamp100(slime_state.energy+2);
    slime_state.hunger=s_clamp100(slime_state.hunger-1);
    slime_state.fun   =s_clamp100(slime_state.fun-1);
  }else{
    if(slime_state.tick%2===0){ slime_state.hunger=s_clamp100(slime_state.hunger-2); }
    if(slime_state.tick%3===0){ slime_state.fun   =s_clamp100(slime_state.fun-2); }
    if(slime_state.tick%5===0){ slime_state.clean =s_clamp100(slime_state.clean-1); }
    if(slime_state.tick%2===0){ slime_state.energy=s_clamp100(slime_state.energy-1); }
  }
  const avg=Math.round((slime_state.hunger+slime_state.energy+slime_state.clean+slime_state.fun)/4);
  if(avg>=70 && slime_state.tick%2===0){ slime_gainXP(1); }
  if(slime_state.tick%20===0){ slime_state.isNight=!slime_state.isNight; slime_renderDayNight(); if(slime_state.isNight){slime_say("よるになったよ");} else {slime_say("あさになったよ");} }
  slime_renderBars(); slime_renderButtons(); slime_renderSlime();
  if(avg<30 && slime_state.tick%4===0){ slime_say("おせわして～！"); }
  if(slime_state.tick%15===0 && !slime_state.sleeping){ slime_say("いっしょにあそぼ！"); }
}
function slime_gainXP(n){
  slime_state.xp+=n;
  while(slime_state.xp>=slime_state.nextXP){ slime_state.xp-=slime_state.nextXP; slime_levelUp(); }
  slime_renderLevel();
}
function slime_levelUp(){
  slime_state.level+=1; slime_say("レベルアップ！ Lv."+slime_state.level);
  slime_state.nextXP = Math.round(slime_state.nextXP*1.1)+5;
}
function slime_save(){
  try{ localStorage.setItem(SLIME_SAVE_KEY, JSON.stringify(slime_state)); }catch(e){}
}
function slime_load(){
  try{
    const raw=localStorage.getItem(SLIME_SAVE_KEY); if(!raw) return false;
    const d=JSON.parse(raw);
    slime_state.hunger=s_clamp100(Number(d.hunger||70));
    slime_state.energy=s_clamp100(Number(d.energy||70));
    slime_state.clean =s_clamp100(Number(d.clean ||70));
    slime_state.fun   =s_clamp100(Number(d.fun   ||70));
    slime_state.level =Math.max(1,Number(d.level||1));
    slime_state.xp    =Math.max(0,Number(d.xp   ||0));
    slime_state.nextXP=Math.max(10,Number(d.nextXP||30));
    slime_state.sleeping=Boolean(d.sleeping||false);
    slime_state.isNight =Boolean(d.isNight ||false);
    slime_state.paused  =Boolean(d.paused  ||false);
    slime_state.tick=0; return true;
  }catch(e){ return false; }
}
function slime_bind(){
  s_byId("s-btn-feed").addEventListener("click",slime_onClickFeed);
  s_byId("s-btn-play").addEventListener("click",slime_onClickPlay);
  s_byId("s-btn-bath").addEventListener("click",slime_onClickBath);
  s_byId("s-btn-sleep").addEventListener("click",slime_onClickSleep);
  s_byId("s-btn-med").addEventListener("click",slime_onClickMed);
  s_byId("s-btn-pause").addEventListener("click",slime_onClickPause);
}
function slime_start(){
  const loaded=slime_load();
  if(!loaded) slime_say("こんにちは！ぼくはスライムだよ！"); else slime_say("おかえり！");
  slime_renderBars(); slime_renderLevel(); slime_renderDayNight(); slime_renderSlime(); slime_updatePauseUI(); slime_renderButtons();
  slime_loopId=setInterval(slime_updateSecond,1000);
  slime_started=true;
}
function slime_stop(){
  if(slime_loopId){ clearInterval(slime_loopId); slime_loopId=0; }
}
function slime_onEnter(){
  if(!slime_started){ slime_bind(); slime_start(); }
  else { slime_state.paused=false; slime_updatePauseUI(); }
}
function slime_onLeave(){
  slime_state.paused=true; slime_updatePauseUI();
}

/* ==========================================================
   マイクラ風じゃんけん —— すべて j- 接頭辞
   ========================================================== */
const J_HANDS = { ROCK:"グー", SCISSORS:"チョキ", PAPER:"パー" };
let j_player=0, j_cpu=0, j_total=0, j_processing=false;
let j_night=false;
const J_MOON_PHASES=["moon--new","moon--crescent","moon--half","moon--gibbous","moon--full"];
let j_moonIndex=4;
let j_creditToken=0, j_creditTimer=0, j_creditLine=0, j_creditChar=0;
const j_creditsLines=["== Staff Roll ==","作者: 與那城明希","すきなもの: チョコチップクッキー","さけていること: SNSの投稿"];

function j_byId(id){ return document.getElementById(id); }
function j_root(){ return document.getElementById("jankenRoot"); }

function j_playDamage(){
  try{
    const AC=window.AudioContext||window.webkitAudioContext,ctx=new AC();
    const o=ctx.createOscillator(),g=ctx.createGain();
    g.gain.setValueAtTime(.7,ctx.currentTime); g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.2);
    o.frequency.setValueAtTime(100,ctx.currentTime); o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+.2);
  }catch(e){}
}
function j_potion(){
  const colors=["#00FFFF","#FF00FF","#FFFF00","#00FF00","#FF4500"]; const ef=j_byId("j_effect");
  let i=0; while(i<5){ i++; const b=document.createElement("div"); b.className="potion-effect";
    b.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
    b.style.left=(50+(Math.random()*20-10))+"%"; b.style.top=(50+(Math.random()*20-10))+"%";
    ef.appendChild(b); setTimeout(j_removeEffect, 800+i*100, b);
  }
}
function j_removeEffect(el){ if(el&&el.remove){ el.remove(); } }
function j_explosion(){
  j_playDamage(); const flash=document.createElement("div"); flash.className="explosion-effect";
  j_byId("j_effect").appendChild(flash); setTimeout(j_removeEffect,500,flash);
}
function j_startSnow(){
  j_stopSnow(); const root=j_root(); let i=0; while(i<40){ i++; const f=document.createElement("div"); f.className="snowflake"; f.textContent="❄";
    f.style.left=Math.random()*100+"%"; f.style.fontSize=(8+Math.random()*10)+"px";
    f.style.animationDuration=(4+Math.random()*6)+"s"; f.style.animationDelay=Math.random()*5+"s"; root.appendChild(f);
  }
}
function j_stopSnow(){ const root=j_root(); const arr=root.querySelectorAll(".snowflake"); for(let i=0;i<arr.length;i++){ arr[i].remove(); } }

function j_applyMoonPhase(moon){
  for(let i=0;i<J_MOON_PHASES.length;i++){ moon.classList.remove(J_MOON_PHASES[i]); }
  moon.classList.add(J_MOON_PHASES[j_moonIndex]);
}
function j_onMoonClick(ev){
  ev.stopPropagation();
  j_moonIndex=(j_moonIndex+1)%J_MOON_PHASES.length;
  const moon=j_root().querySelector(".moon"); if(moon){ j_applyMoonPhase(moon); }
  if(navigator.vibrate){ navigator.vibrate(8); }
}
function j_ensureMoon(){
  let moon=j_root().querySelector(".moon");
  if(!moon){
    moon=document.createElement("div"); moon.className="moon";
    moon.addEventListener("click", j_onMoonClick);
    j_root().appendChild(moon);
  }
  j_applyMoonPhase(moon);
  return moon;
}
function j_ensureDim(){
  let dim=j_root().querySelector(".night-dim");
  if(!dim){ dim=document.createElement("div"); dim.className="night-dim"; j_root().appendChild(dim); }
  return dim;
}
function j_removeDim(){
  const dim=j_root().querySelector(".night-dim"); if(dim){ dim.remove(); }
}

function j_cpuMove(){
  const arr=[J_HANDS.ROCK,J_HANDS.SCISSORS,J_HANDS.PAPER];
  return arr[Math.floor(Math.random()*arr.length)];
}
function j_decide(p,c){
  if(p===c) return "draw";
  if((p===J_HANDS.ROCK&&c===J_HANDS.SCISSORS)||(p===J_HANDS.SCISSORS&&c===J_HANDS.PAPER)||(p===J_HANDS.PAPER&&c===J_HANDS.ROCK)){ j_player++; return "player"; }
  j_cpu++; return "cpu";
}

function j_toggleNight(){
  j_night=!j_night;
  const root=j_root(); root.classList.toggle("theme-night", j_night);
  if(j_night){ j_ensureDim(); j_ensureMoon(); } else { j_removeDim(); const m=root.querySelector(".moon"); if(m){ m.remove(); } }
  if(navigator.vibrate){ navigator.vibrate(10); }
}

function j_changeBiome(){
  const root=j_root(); j_stopSnow();
  const list=["biome-plain","biome-forest","biome-darkforest","biome-mushroom","biome-snow"];
  for(let i=0;i<list.length;i++){ root.classList.remove(list[i]); }
  let label="";
  if(j_player<5){ root.classList.add("biome-plain"); label="🌿 平原バイオーム"; }
  else if(j_player<10){ root.classList.add("biome-forest"); label="🌲 森林バイオーム"; }
  else if(j_player<15){ root.classList.add("biome-darkforest"); label="🌳 深い森バイオーム"; }
  else if(j_player<20){ root.classList.add("biome-mushroom"); label="🍄 キノコ島バイオーム"; }
  else { root.classList.add("biome-snow"); label="🏔️ 雪原バイオーム"; j_startSnow(); }
  root.classList.toggle("theme-night", j_night); if(j_night){ j_ensureDim(); j_ensureMoon(); }
  const banner=document.createElement("div"); banner.className="biome-banner"; banner.textContent=label+"へ進んだ！"; root.appendChild(banner);
  setTimeout(j_removeEffect,2500,banner);
}

/* 1ラウンド：ボタンから呼ばれる */
let j_pendingChoice="";
let j_thinkTimer=0;
function j_onRock(){ j_play(J_HANDS.ROCK); }
function j_onScissors(){ j_play(J_HANDS.SCISSORS); }
function j_onPaper(){ j_play(J_HANDS.PAPER); }
function j_play(choice){
  if(j_processing) return; j_processing=true; j_total++; j_pendingChoice=choice;
  if(navigator.vibrate){ navigator.vibrate(10); }
  j_byId("j-resultText").textContent="CPUが考え中...";
  j_thinkTimer = setTimeout(j_resolveGame, 2000);
}
function j_resolveGame(){
  const cpu=j_cpuMove(); const w=j_decide(j_pendingChoice, cpu);
  let msg="", color="text-gray-900";
  if(w==="player"){ msg="プレイヤーの勝利！🏆"; color="text-green-600"; j_potion(); j_changeBiome(); }
  else if(w==="cpu"){ msg="クリーパーの勝利... 💀"; color="text-red-600"; j_explosion(); }
  else { msg="引き分け！もう一度！"; color="text-gray-900"; }
  j_byId("j-playerScore").textContent=j_player;
  j_byId("j-cpuScore").textContent=j_cpu;
  j_byId("j-winRate").textContent=((j_player/j_total)*100||0).toFixed(2)+"%";
  const rt=j_byId("j-resultText"); rt.textContent=msg; rt.className="text-2xl font-bold "+color;
  j_byId("j-playerHand").textContent=j_pendingChoice;
  j_byId("j-cpuHand").textContent=cpu;
  j_processing=false;
}
function j_reset(){
  j_player=0; j_cpu=0; j_total=0;
  j_byId("j-playerScore").textContent="0";
  j_byId("j-cpuScore").textContent="0";
  j_byId("j-winRate").textContent="0.00%";
  j_byId("j-playerHand").textContent="?";
  j_byId("j-cpuHand").textContent="?";
  const rt=j_byId("j-resultText"); rt.textContent="あなたの手を選んでください！"; rt.className="text-2xl font-bold text-gray-900";
  j_changeBiome();
}

/* クレジット（毎回流す・無名関数なし） */
function j_openCredits(){
  j_creditToken++; j_creditLine=0; j_creditChar=0;
  const panel=j_byId("j-credits"); const log=j_byId("j-credits-log");
  log.textContent=""; panel.classList.add("open"); panel.setAttribute("aria-hidden","false");
  if(j_creditTimer){ clearInterval(j_creditTimer); j_creditTimer=0; }
  j_creditTimer = setInterval(j_creditTick, 25);
  if(navigator.vibrate){ navigator.vibrate(10); }
}
function j_closeCredits(){
  j_creditToken++; const panel=j_byId("j-credits");
  panel.classList.remove("open"); panel.setAttribute("aria-hidden","true");
  if(j_creditTimer){ clearInterval(j_creditTimer); j_creditTimer=0; }
  if(navigator.vibrate){ navigator.vibrate(5); }
}
function j_creditTick(){
  const log=j_byId("j-credits-log");
  if(j_creditLine>=j_creditsLines.length){
    if(j_creditTimer){ clearInterval(j_creditTimer); j_creditTimer=0; }
    const cur=document.createElement("span"); cur.className="cursor"; cur.textContent="▋"; log.appendChild(cur);
    log.scrollTop=log.scrollHeight; return;
  }
  /* 現在の行の文字を一つずつ増やす */
  const lines = j_creditsLines;
  const want = lines[j_creditLine];
  /* 行要素がなければ作る */
  let lineEl = log.querySelector("div[data-i='"+j_creditLine+"']");
  if(!lineEl){ lineEl=document.createElement("div"); lineEl.className="log-line"; lineEl.setAttribute("data-i", String(j_creditLine)); log.appendChild(lineEl); }
  lineEl.textContent = want.slice(0, j_creditChar);
  j_creditChar++;
  if(j_creditChar>want.length){
    j_creditLine++; j_creditChar=0;
  }
  log.scrollTop=log.scrollHeight;
}
function j_onKeyDown(e){
  if(e.key==="Escape"){ const p=j_byId("j-credits"); if(p.classList.contains("open")){ j_closeCredits(); } }
}

/* じゃんけん 画面入退場 */
let j_bound=false;
function j_bind(){
  j_byId("j-btn-rock").addEventListener("click", j_onRock);
  j_byId("j-btn-scissors").addEventListener("click", j_onScissors);
  j_byId("j-btn-paper").addEventListener("click", j_onPaper);
  j_byId("j-btn-reset").addEventListener("click", j_reset);
  j_byId("j-btn-night").addEventListener("click", j_toggleNight);
  j_byId("j-btn-credits").addEventListener("click", j_openCredits);
  j_byId("j-btn-credits-close").addEventListener("click", j_closeCredits);
  window.addEventListener("keydown", j_onKeyDown);
  j_bound=true;
}
function janken_onEnter(){
  if(!j_bound){ j_bind(); }
  j_reset();
}
function janken_onLeave(){
  /* 進行中の思考タイマー・クレジット等を安全に停止 */
  if(j_thinkTimer){ clearTimeout(j_thinkTimer); j_thinkTimer=0; j_processing=false; }
  j_closeCredits();
}

/* 起動時はメニュー */
showMenu();
</script>
</body>
</html>
