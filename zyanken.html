<!DOCTYPE html>
<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>マイクラ風じゃんけん</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

/* === 全体 === */
body{
  display:flex;justify-content:center;align-items:center;
  min-height:100vh;margin:0;overflow:hidden;position:relative;padding:20px;
  transition:background 1.5s ease-in-out,filter .6s ease-in-out;
}

/* === バイオーム（CSS背景方式） === */
.biome-plain{background:linear-gradient(#78a7ff 60%,#559144 40%)}
.biome-forest{
  background:
    radial-gradient(circle at 10% 90%,#2f5f2f 1%,transparent 2%),
    radial-gradient(circle at 50% 80%,#3a753a 1%,transparent 2%),
    radial-gradient(circle at 90% 85%,#2f5f2f 1%,transparent 2%),
    linear-gradient(#4a7c2d 60%,#2f5220 40%);
  background-size:200px 200px;
}
.biome-darkforest{
  background:
    radial-gradient(circle at 20% 85%,#203c20 1%,transparent 2%),
    radial-gradient(circle at 70% 90%,#1c301c 1%,transparent 2%),
    radial-gradient(circle at 90% 80%,#243a24 1%,transparent 2%),
    linear-gradient(#1f3c1a 60%,#14250e 40%);
  background-size:150px 150px;
}
.biome-mushroom{
  background:
    radial-gradient(circle at 30% 85%,#c04ba3 1.5%,transparent 2%),
    radial-gradient(circle at 70% 90%,#b35fbd 1.5%,transparent 2%),
    linear-gradient(#8a55a3 60%,#4a2b7f 40%);
  background-size:250px 250px;
}
.biome-snow{
  background:
    radial-gradient(circle at 10% 80%,#ffffff 0.5%,transparent 1.5%),
    radial-gradient(circle at 50% 85%,#ffffff 0.5%,transparent 1.5%),
    radial-gradient(circle at 90% 90%,#ffffff 0.5%,transparent 1.5%),
    linear-gradient(#b0d0ff 60%,#e6f3ff 40%);
  background-size:250px 250px;
}

/* === デイ/ナイト === */
.theme-night{filter:none}
.theme-night::before{
  content:"";position:fixed;inset:0;z-index:2;pointer-events:none;
  background:
    radial-gradient(1px 1px at 20% 10%,#fff 70%,transparent 71%),
    radial-gradient(1px 1px at 35% 25%,#dfe8ff 70%,transparent 71%),
    radial-gradient(1px 1px at 55% 15%,#fff 70%,transparent 71%),
    radial-gradient(1px 1px at 80% 30%,#eaf1ff 70%,transparent 71%),
    radial-gradient(1px 1px at 10% 35%,#fff 70%,transparent 71%),
    radial-gradient(1px 1px at 70% 12%,#fff 70%,transparent 71%);
  opacity:.8;
}
/* 背景だけ暗くする減光 */
.night-dim{
  position:fixed;inset:0;pointer-events:none;z-index:1;
  background:radial-gradient(circle at 50% 20%,rgba(0,0,0,.22) 0 45%,rgba(0,0,0,.35) 70%,rgba(0,0,0,.45) 100%);
}

/* 🌙 月（クリックで満ち欠け） */
@keyframes moon-float{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-4px) rotate(.6deg)}100%{transform:translateY(0) rotate(0)}}
.moon{
  position:fixed;top:8%;right:6%;width:84px;height:84px;border-radius:50%;
  z-index:3;pointer-events:auto;cursor:pointer;animation:moon-float 6s ease-in-out infinite;
  background:
    radial-gradient(circle at 35% 35%,rgba(255,255,255,.9) 0 24%,rgba(255,255,255,0) 25%),
    radial-gradient(circle at 65% 55%,rgba(255,255,255,.8) 0 18%,rgba(255,255,255,0) 19%),
    radial-gradient(circle at 55% 25%,rgba(255,255,255,.7) 0 10%,rgba(255,255,255,0) 11%),
    radial-gradient(circle at 70% 30%,rgba(255,255,255,.5) 0 8%,rgba(255,255,255,0) 9%),
    radial-gradient(circle,#f7f7fb 0,#e6e9f5 60%,#cfd6ee 100%);
  box-shadow:0 0 18px 6px rgba(255,255,255,.25),0 0 40px 10px rgba(210,220,255,.15);
}
.moon::before{
  content:"";position:absolute;inset:0;border-radius:50%;background:rgba(0,0,20,.88);
  transform:translateX(var(--cover-x,0)) scaleX(var(--cover-scale,1));transition:transform .35s ease;
}
.moon--new{opacity:.25}
.moon--crescent{--cover-x:-22px;--cover-scale:1.08}
.moon--half{--cover-x:0;--cover-scale:1}
.moon--gibbous{--cover-x:18px;--cover-scale:.55}
.moon--full{--cover-scale:0}

@media (max-width:639px){
  .moon{width:56px;height:56px;top:6%;right:5%}
}

/* === UI === */
.minecraft-box{
  position:relative;z-index:10;background:#f0f0f0;border-radius:0;border:4px solid #3d3d3d;
  box-shadow:8px 8px 0 rgba(0,0,0,.5),inset 4px 4px 0 rgba(255,255,255,.3)
}
.minecraft-button{
  border-radius:0;border:2px solid #3d3d3d;
  box-shadow:inset -4px -4px 0 rgba(0,0,0,.5),inset 4px 4px 0 rgba(255,255,255,.5)
}
.minecraft-button:active{
  transform:translateY(2px);filter:brightness(.8);
  box-shadow:inset 4px 4px 0 rgba(0,0,0,.5),inset -4px 4px 0 rgba(255,255,255,.5)
}

/* === エフェクト（クリック透過） === */
#effectContainer{position:absolute;inset:0;overflow:hidden;pointer-events:none;z-index:50}
@keyframes potion-pop{0%{transform:scale(0);opacity:1}100%{transform:scale(3);opacity:0}}
.potion-effect{position:absolute;top:50%;left:50%;width:50px;height:50px;background:#ff00ff;animation:potion-pop .8s ease-out forwards;transform:translate(-50%,-50%);pointer-events:none;z-index:100}
@keyframes explosion-flash{0%{background:transparent}20%{background:#ffe53c}40%{background:#ffb73c}60%{background:#ffe53c}80%{background:#ffb73c}100%{background:transparent}}
.explosion-effect{position:absolute;inset:0;animation:explosion-flash .5s ease-out forwards;pointer-events:none;z-index:90}

/* ❄ 雪 */
.snowflake{position:absolute;top:-10px;color:#fff;font-size:12px;opacity:.8;animation:fall linear infinite;pointer-events:none;z-index:5}
@keyframes fall{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(100vh) rotate(360deg)}}

/* バナー */
.biome-banner{
  position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:200;background:rgba(0,0,0,.7);
  color:#fff;padding:10px 20px;border:2px solid #fff;font-size:1.2rem;animation:fade-banner 2.5s ease-in-out forwards
}
@keyframes fade-banner{0%{opacity:0;transform:translate(-50%,-20px)}20%{opacity:1;transform:translate(-50%,0)}80%{opacity:1}100%{opacity:0;transform:translate(-50%,-20px)}}

/* 📱 モバイル最適化 */
.janken-btn{touch-action:manipulation}
@media (max-width:639px){
  .grid-janken{grid-template-columns:1fr!important}
  .janken-btn{font-size:1.5rem;padding-block:1.1rem}
  .toolbar-wrap{flex-direction:column;gap:.5rem;align-items:stretch}
}

/* === 📜 クレジット（スタッフロール・ログ風） === */
.credits-fab{
  position:fixed;left:16px;bottom:16px;z-index:350;
  background:#e5e7eb;padding:.6rem .9rem;font-size:.9rem;
}
.credits-panel{
  position:fixed;left:16px;bottom:16px;z-index:360;
  width:320px;max-height:48vh;background:#111;color:#b7ffb7;border:4px solid #3d3d3d;border-radius:0;
  box-shadow:8px 8px 0 rgba(0,0,0,.6),inset 4px 4px 0 rgba(255,255,255,.06);
  transform:translateY(calc(100% + 16px));transition:transform .35s ease;
  display:flex;flex-direction:column;gap:0;
}
.credits-panel.open{ transform:translateY(0); }
.credits-header{
  background:#1b1b1b;color:#fff;border-bottom:2px solid #333;padding:.45rem .6rem;display:flex;justify-content:space-between;align-items:center;
  font-weight:700;letter-spacing:.02em;
}
.credits-close{background:#333;color:#fff;border:2px solid #555;padding:.15rem .5rem;cursor:pointer}
.credits-log{
  padding:.6rem;font-family:ui-monospace,Menlo,Consolas,monospace;
  white-space:pre-wrap;overflow:auto;flex:1;line-height:1.35;background:#0b0f0b;
  border-top:2px solid #0c120c;
}
.log-line{margin:0 0 .25rem 0}
.cursor{display:inline-block;margin-left:2px;animation:blink 1s steps(1) infinite}
@keyframes blink{50%{opacity:0}}

@media (max-width:639px){
  .credits-panel{width:calc(100vw - 32px);max-height:60vh}
}
</style>
</head>

<body class="biome-plain flex justify-center items-center">
  <div id="gameContainer" class="minecraft-box p-6 md:p-8 w-full max-w-lg">
    <div id="effectContainer"></div>

    <h1 class="text-3xl font-bold text-center mb-4 text-gray-800 border-b-4 border-gray-800 pb-2">
      ⛏️ ブロック・じゃんけん！ ⛏️
    </h1>

    <div class="flex justify-around items-center mb-4 bg-gray-700 p-4 minecraft-box text-white">
      <div class="text-center">
        <p class="text-lg font-bold">プレイヤー</p>
        <p id="playerScore" class="text-4xl text-green-400">0</p>
      </div>
      <p class="text-2xl mx-4">VS</p>
      <div class="text-center">
        <p class="text-lg font-bold">CPU (クリーパー)</p>
        <p id="cpuScore" class="text-4xl text-red-400">0</p>
      </div>
    </div>

    <div class="text-center mb-4 bg-gray-200 p-2 border-2 border-gray-500">
      <p class="text-lg font-bold text-gray-800">勝率 (Win Rate)</p>
      <p id="winRate" class="text-2xl font-black text-gray-700">0.00%</p>
    </div>

    <div class="text-center mb-4 p-4 border-4 border-dashed border-gray-500">
      <p id="resultText" class="text-2xl font-bold h-8 text-gray-900">あなたの手を選んでください！</p>
      <div class="flex justify-around mt-4">
        <div><p class="text-lg text-gray-600">あなた</p><p id="playerHandDisplay" class="text-4xl text-blue-600">?</p></div>
        <div><p class="text-lg text-gray-600">CPU</p><p id="cpuHandDisplay" class="text-4xl text-red-600">?</p></div>
      </div>
    </div>

    <!-- じゃんけんボタン：スマホは1列 -->
    <div class="grid grid-cols-3 gap-3 mb-4 sm:grid-cols-3 grid-janken">
      <button onclick="playerMove('グー')"   class="janken-btn minecraft-button bg-red-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">グー</button>
      <button onclick="playerMove('チョキ')" class="janken-btn minecraft-button bg-green-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">チョキ</button>
      <button onclick="playerMove('パー')"   class="janken-btn minecraft-button bg-blue-500 text-white py-4 text-xl font-bold sm:py-4 sm:text-xl">パー</button>
    </div>

    <!-- ツールバー -->
    <div class="flex items-center justify-between gap-3 toolbar-wrap">
      <button onclick="resetGame()" class="minecraft-button w-full bg-yellow-400 text-gray-900 font-bold py-3 text-lg">スコアをリセット</button>
      <button id="nightBtn" onclick="toggleNight()" class="minecraft-button bg-gray-300 px-4 py-3 text-sm">🌙 / ☀ 切替</button>
    </div>
  </div>

  <!-- 📜 クレジット：左下フローティングボタン -->
  <button id="creditsBtn" class="minecraft-button credits-fab">📜 クレジット</button>

  <!-- 📜 クレジット：ログ風パネル -->
  <div id="creditsPanel" class="credits-panel" aria-hidden="true" role="dialog" aria-label="スタッフロール">
    <div class="credits-header">
      <span>STAFF ROLL / LOG</span>
      <button id="creditsClose" class="credits-close" aria-label="閉じる">×</button>
    </div>
    <div id="creditsLog" class="credits-log" aria-live="polite"></div>
  </div>

<script>
/* ========== 定数・状態 ========== */
const HANDS={ROCK:'グー',SCISSORS:'チョキ',PAPER:'パー'};
let playerScore=0,cpuScore=0,totalGames=0,isProcessing=false;
let NIGHT=false;

/* 🌙 満ち欠け管理 */
const MOON_PHASES=['moon--new','moon--crescent','moon--half','moon--gibbous','moon--full'];
let moonPhaseIndex=4;

/* クリック透過レイヤー */
const effectContainer=document.getElementById('effectContainer');

/* ========== サウンド ========== */
function playDamageSound(){
  try{
    const AC=window.AudioContext||window.webkitAudioContext,ctx=new AC();
    const osc=ctx.createOscillator(),g=ctx.createGain();
    g.gain.setValueAtTime(.7,ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.2);
    osc.frequency.setValueAtTime(100,ctx.currentTime);
    osc.connect(g);g.connect(ctx.destination);osc.start();osc.stop(ctx.currentTime+.2);
  }catch(e){}
}

/* ========== エフェクト ========== */
function triggerPotionEffect(){
  const colors=['#00FFFF','#FF00FF','#FFFF00','#00FF00','#FF4500'];
  for(let i=0;i<5;i++){
    const b=document.createElement('div');b.className='potion-effect';
    b.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
    b.style.left=(50+(Math.random()*20-10))+'%';b.style.top=(50+(Math.random()*20-10))+'%';
    effectContainer.appendChild(b);setTimeout(()=>b.remove(),800+i*100);
  }
}
function triggerExplosionEffect(){
  playDamageSound();
  const flash=document.createElement('div');flash.className='explosion-effect';
  effectContainer.appendChild(flash);setTimeout(()=>flash.remove(),500);
}
/* 雪（雪原のみ） */
function startSnow(){
  document.querySelectorAll('.snowflake').forEach(f=>f.remove());
  for(let i=0;i<40;i++){
    const f=document.createElement('div');f.className='snowflake';f.textContent='❄';
    f.style.left=Math.random()*100+'%';f.style.fontSize=(8+Math.random()*10)+'px';
    f.style.animationDuration=(4+Math.random()*6)+'s';f.style.animationDelay=Math.random()*5+'s';
    document.body.appendChild(f);
  }
}
function stopSnow(){document.querySelectorAll('.snowflake').forEach(f=>f.remove())}

/* ========== 月DOM（クリックで満ち欠け） ========== */
function applyMoonPhase(moon){
  MOON_PHASES.forEach(c=>moon.classList.remove(c));
  moon.classList.add(MOON_PHASES[moonPhaseIndex]);
}
function ensureMoon(){
  let moon=document.getElementById('moon');
  if(!moon){
    moon=document.createElement('div');
    moon.id='moon';moon.className='moon';
    moon.addEventListener('click',(e)=>{
      e.stopPropagation();
      moonPhaseIndex=(moonPhaseIndex+1)%MOON_PHASES.length;
      applyMoonPhase(moon);
      if(navigator.vibrate)navigator.vibrate(8);
    });
    document.body.appendChild(moon);
  }
  applyMoonPhase(moon);
  return moon;
}

/* ========== 夜の減光レイヤー ========== */
function ensureNightDim(){
  let dim=document.getElementById('nightDim');
  if(!dim){
    dim=document.createElement('div');
    dim.id='nightDim';
    dim.className='night-dim';
    document.body.appendChild(dim);
  }
  return dim;
}
function removeNightDim(){
  const dim=document.getElementById('nightDim');
  if(dim) dim.remove();
}

/* ========== ロジック ========== */
function cpuMove(){const h=Object.values(HANDS);return h[Math.floor(Math.random()*h.length)]}
function determineWinner(p,c){
  if(p===c)return'draw';
  if((p===HANDS.ROCK&&c===HANDS.SCISSORS)||(p===HANDS.SCISSORS&&c===HANDS.PAPER)||(p===HANDS.PAPER&&c===HANDS.ROCK)){playerScore++;return'player'}
  else{cpuScore++;return'cpu'}
}

/* デイ/ナイト切替 */
function toggleNight(){
  NIGHT=!NIGHT;
  document.body.classList.toggle('theme-night',NIGHT);

  if(NIGHT){
    ensureNightDim();
    ensureMoon();
  }else{
    removeNightDim();
    const m=document.getElementById('moon');if(m)m.remove();
  }
  if(navigator.vibrate)navigator.vibrate(10);
}

/* バイオーム切替（biome-のみ付替え） */
function changeBackground(){
  const body=document.body;stopSnow();
  body.classList.forEach(c=>{if(c.startsWith('biome-'))body.classList.remove(c)});
  let label='';
  if(playerScore<5){body.classList.add('biome-plain');label='🌿 平原バイオーム'}
  else if(playerScore<10){body.classList.add('biome-forest');label='🌲 森林バイオーム'}
  else if(playerScore<15){body.classList.add('biome-darkforest');label='🌳 深い森バイオーム'}
  else if(playerScore<20){body.classList.add('biome-mushroom');label='🍄 キノコ島バイオーム'}
  else{body.classList.add('biome-snow');label='🏔️ 雪原バイオーム';startSnow()}
  document.body.classList.toggle('theme-night',NIGHT);
  if(NIGHT){ ensureNightDim(); ensureMoon(); }

  const banner=document.createElement('div');banner.className='biome-banner';
  banner.textContent=`${label}へ進んだ！`;document.body.appendChild(banner);
  setTimeout(()=>banner.remove(),2500);
}

/* ========== UI ========== */
function playerMove(choice){
  if(isProcessing)return;isProcessing=true;totalGames++;
  if(navigator.vibrate)navigator.vibrate(10);
  document.getElementById('resultText').textContent='CPUが考え中...';

  setTimeout(()=>{
    const cpu=cpuMove(),w=determineWinner(choice,cpu);
    let msg,color;
    if(w==='player'){msg='プレイヤーの勝利！🏆';color='text-green-600';triggerPotionEffect();changeBackground()}
    else if(w==='cpu'){msg='クリーパーの勝利... 💀';color='text-red-600';triggerExplosionEffect()}
    else{msg='引き分け！もう一度！';color='text-gray-900'}

    document.getElementById('playerScore').textContent=playerScore;
    document.getElementById('cpuScore').textContent=cpuScore;
    document.getElementById('winRate').textContent=((playerScore/totalGames)*100||0).toFixed(2)+'%';
    const rt=document.getElementById('resultText');rt.textContent=msg;rt.className='text-2xl font-bold '+color;
    document.getElementById('playerHandDisplay').textContent=choice;
    document.getElementById('cpuHandDisplay').textContent=cpu;

    isProcessing=false;
  },2000);
}

function resetGame(){
  playerScore=0;cpuScore=0;totalGames=0;
  document.getElementById('playerScore').textContent='0';
  document.getElementById('cpuScore').textContent='0';
  document.getElementById('winRate').textContent='0.00%';
  document.getElementById('playerHandDisplay').textContent='?';
  document.getElementById('cpuHandDisplay').textContent='?';
  const rt=document.getElementById('resultText');rt.textContent='あなたの手を選んでください！';rt.className='text-2xl font-bold text-gray-900';
  if(navigator.vibrate)navigator.vibrate(10);
  changeBackground();
}

/* ========== 📜 クレジット（毎回流れる版） ========== */
const creditBtn=document.getElementById('creditsBtn');
const creditPanel=document.getElementById('creditsPanel');
const creditClose=document.getElementById('creditsClose');
const creditLog=document.getElementById('creditsLog');

const CREDIT_LINES=[
  "== Staff Roll ==",
  "作者: 與那城明希",
  "すきなもの: チョコチップクッキー",
  "さけていること: SNSの投稿"
];

// アニメ中断用トークン
let creditAnimationToken=0;

function appendLineAnimated(text, token){
  return new Promise(resolve=>{
    const line=document.createElement('div');
    line.className='log-line';
    creditLog.appendChild(line);
    let i=0;
    const tick=setInterval(()=>{
      if(token!==creditAnimationToken){ clearInterval(tick); return resolve('cancel'); }
      line.textContent=text.slice(0,i);
      i++;
      creditLog.scrollTop=creditLog.scrollHeight;
      if(i>text.length){ clearInterval(tick); resolve('done'); }
    },25);
  });
}

async function playCreditLog(token){
  creditLog.textContent='';
  for(const t of CREDIT_LINES){
    const r=await appendLineAnimated(t, token);
    if(token!==creditAnimationToken) return; // 中断
  }
  const cur=document.createElement('span');cur.className='cursor';cur.textContent='▋';
  creditLog.appendChild(cur);
  creditLog.scrollTop=creditLog.scrollHeight;
}

function openCredits(){
  creditAnimationToken++; // 以前のアニメを中断し、新規セッションID発行
  const token=creditAnimationToken;
  creditPanel.classList.add('open');
  creditPanel.setAttribute('aria-hidden','false');
  playCreditLog(token);   // 毎回最初から再生
  if(navigator.vibrate)navigator.vibrate(10);
}
function closeCredits(){
  creditAnimationToken++; // アニメ中断
  creditPanel.classList.remove('open');
  creditPanel.setAttribute('aria-hidden','true');
  if(navigator.vibrate)navigator.vibrate(5);
}

creditBtn.addEventListener('click',openCredits);
creditClose.addEventListener('click',closeCredits);
window.addEventListener('keydown',e=>{ if(e.key==='Escape'&&creditPanel.classList.contains('open')) closeCredits(); });

/* ========== 起動 ========== */
window.onload=resetGame;
window.addEventListener('touchstart',()=>{}, {passive:true});
</script>
</body>
</html>
