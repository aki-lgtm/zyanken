<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ãƒ”ã‚¯ã‚»ãƒ«ãƒšãƒƒãƒˆâ˜†ã‚¹ãƒ©ã‚¤ãƒ è‚²æˆï¼ˆãƒãƒ¼ã‚ºä»˜ãï¼‰</title>
<style>
  :root{
    --bg-sky:#a9d6ff;
    --bg-sky-night:#1a2240;
    --bg-ground:#6bb36b;
    --ui-dark:#222;
    --ui-light:#f7f7fb;
  }

  body{
    margin:0;
    font-family: ui-rounded, system-ui, -apple-system, "Segoe UI",
      "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    background: linear-gradient(var(--bg-sky), var(--bg-sky) 60%, var(--bg-ground) 60%, var(--bg-ground));
    min-height:100svh;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#1b1b1b;
  }
  .night{
    background: linear-gradient(var(--bg-sky-night), var(--bg-sky-night) 60%, var(--bg-ground) 60%, var(--bg-ground));
    color:#e8ecff;
  }

  .box{
    width:min(860px, 96vw);
    background:var(--ui-light);
    border:4px solid #3d3d3d;
    border-radius:16px;
    box-shadow:8px 8px 0 rgba(0,0,0,.25), inset 4px 4px 0 rgba(255,255,255,.5);
    padding:16px;
  }
  h1{ margin:0 0 10px 0; font-size:clamp(22px, 3vw, 32px); text-align:center; color:#111; }

  .stage{
    position:relative;
    border:4px solid #3d3d3d;
    border-radius:12px;
    background: radial-gradient(ellipse at 50% 20%, rgba(255,255,255,.6), transparent 60%);
    height: 280px;
    overflow:hidden;
  }
  .night .stage{
    background: radial-gradient(ellipse at 50% 20%, rgba(255,255,255,.12), transparent 60%);
  }

  .sun, .moon{
    position:absolute; top:18px; right:18px; width:42px;height:42px;border-radius:50%;
    box-shadow:0 0 20px rgba(255,255,255,.4);
  }
  .sun{ background:#ffe08a; }
  .night .sun{ display:none; }
  .moon{ display:none; background:#eaefff;}
  .night .moon{ display:block; }

  .slime{
    --slime: #5bd1ff;
    position:absolute; left:50%; bottom:20px; transform:translateX(-50%);
    width:180px; height:140px;
    background: radial-gradient(ellipse at 40% 30%, rgba(255,255,255,.7), rgba(255,255,255,0) 50%), var(--slime);
    border-radius: 120px 120px 60px 60px;
    border:4px solid #2b6aa8;
    box-shadow: 0 8px 0 rgba(0,0,0,.2) inset;
    transition: transform .2s ease, background .3s ease;
  }
  .slime.face::after{
    content: "â—   â—\A  ï¼¿";
    white-space: pre;
    font-weight: 700; line-height: 1.2; color:#1b1b1b;
    position:absolute; top:38%; left:50%; transform:translateX(-50%);
    text-align:center; font-size:22px;
  }
  .slime.sleep::after{ content:"-   -\A  Ï‰"; }

  .bubble{
    position:absolute; left:50%; top:18px; transform:translateX(-50%);
    background:white; color:#222; border:3px solid #333; border-radius:8px;
    padding:8px 12px; font-weight:700; box-shadow:4px 4px 0 rgba(0,0,0,.25);
    opacity:0; transition:opacity .25s ease; pointer-events:none;
  }
  .bubble.show{ opacity:1; }

  /* â¸ ãƒãƒ¼ã‚ºä¸­ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ã®ä¸Šã«å‡ºã™ï¼‰ */
  .pause-overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    background: rgba(0,0,0,.35); color:#fff; font-weight:900; font-size:clamp(18px,3vw,28px);
    border:3px solid #333; backdrop-filter: blur(2px);
    opacity:0; pointer-events:none; transition: opacity .2s ease; z-index:5;
  }
  .pause-overlay.show{ opacity:1; }

  .stats{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin:14px 0 6px; }
  @media (min-width:780px){ .stats{ grid-template-columns: repeat(4,1fr); } }

  .meter{ background:#f0f2ff; border:3px solid #3d3d3d; border-radius:8px; padding:6px 8px; }
  .meter h3{ margin:0 0 4px 0; font-size:14px; color:#222; display:flex; justify-content:space-between; align-items:center; }
  .bar{ background:#e5e7ff; height:14px; border:2px solid #3d3d3d; border-radius:6px; overflow:hidden; }
  .fill{ height:100%; width:50%; background: linear-gradient(90deg, #84d8ff, #2ea0ff); transition: width .2s ease; }
  .fill.ok{ background: linear-gradient(90deg, #86efac, #22c55e);}
  .fill.warn{ background: linear-gradient(90deg, #fde68a, #f59e0b);}
  .fill.bad{ background: linear-gradient(90deg, #fca5a5, #ef4444);}

  .controls{ display:grid; grid-template-columns: repeat(2,1fr); gap:10px; }
  @media (min-width:780px){ .controls{ grid-template-columns: repeat(6,1fr); } } /* â† 6ãƒœã‚¿ãƒ³ã«åˆã‚ã›ãŸ */

  .btn{
    font-weight:900; border:3px solid #3d3d3d; border-radius:10px;
    background:#ffffff; color:#111; padding:12px 10px; cursor:pointer;
    transition: transform .05s ease, filter .1s ease; user-select:none; text-align:center;
    box-shadow: 4px 4px 0 rgba(0,0,0,.25), inset 3px 3px 0 rgba(255,255,255,.65);
  }
  .btn:active{ transform: translateY(2px); filter: brightness(.9); }
  .btn.primary{ background:linear-gradient(#ffffff,#f2f6ff);}
  .btn.sleeping{ background:#dbeafe; }
  .btn.danger{ background:#fee2e2; color:#7f1d1d; }
  .btn:disabled{ opacity:.6; cursor:not-allowed; filter:grayscale(.2); }

  .footer{ display:flex; gap:10px; flex-wrap:wrap; padding-top:10px; color:#333; }
  .chip{ border:3px solid #3d3d3d; border-radius:10px; background:#fff; padding:8px 10px;
         box-shadow: inset 3px 3px 0 rgba(255,255,255,.65); font-weight:800; }
  .note{ margin-top:10px; font-size:13px; color:#333; }
</style>
</head>
<body>

  <main class="box" id="game">
    <h1>ãƒ”ã‚¯ã‚»ãƒ«ãƒšãƒƒãƒˆ â˜† ã‚¹ãƒ©ã‚¤ãƒ è‚²æˆ</h1>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã„ã‚‹å ´æ‰€ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸ï¼‰ -->
    <section class="stage" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¸">
      <div class="sun" aria-hidden="true"></div>
      <div class="moon" aria-hidden="true"></div>
      <div id="slime" class="slime face" role="img" aria-label="ã‚¹ãƒ©ã‚¤ãƒ "></div>
      <div id="bubble" class="bubble" aria-live="polite">ã“ã‚“ã«ã¡ã¯ï¼</div>
      <!-- â¸ ãƒãƒ¼ã‚ºä¸­ã®è¡¨ç¤º -->
      <div id="pauseOverlay" class="pause-overlay" aria-hidden="true">â¸ ä¸€æ™‚åœæ­¢ä¸­</div>
    </section>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼‰ -->
    <section class="stats">
      <div class="meter">
        <h3><span>ãŠãªã‹</span><span id="v-hunger">--</span></h3>
        <div class="bar"><div id="bar-hunger" class="fill"></div></div>
      </div>
      <div class="meter">
        <h3><span>ã’ã‚“ã</span><span id="v-energy">--</span></h3>
        <div class="bar"><div id="bar-energy" class="fill"></div></div>
      </div>
      <div class="meter">
        <h3><span>ãã‚Œã„</span><span id="v-clean">--</span></h3>
        <div class="bar"><div id="bar-clean" class="fill"></div></div>
      </div>
      <div class="meter">
        <h3><span>ã”ãã’ã‚“</span><span id="v-fun">--</span></h3>
        <div class="bar"><div id="bar-fun" class="fill"></div></div>
      </div>
    </section>

    <!-- ã‚²ãƒ¼ãƒ ã®æ“ä½œãƒœã‚¿ãƒ³ -->
    <section class="controls">
      <button id="btn-feed" class="btn primary">ğŸ½ ã”ã¯ã‚“</button>
      <button id="btn-play" class="btn primary">ğŸ² ã‚ãã¶</button>
      <button id="btn-bath" class="btn primary">ğŸ«§ ãŠãµã‚</button>
      <button id="btn-sleep" class="btn primary">ğŸ˜´ ã­ã‚‹</button>
      <button id="btn-med"   class="btn danger">ğŸ’Š ãŠãã™ã‚Š</button>
      <!-- â¸ ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ -->
      <button id="btn-pause" class="btn">â¸ ä¸€æ™‚åœæ­¢</button>
    </section>

    <!-- ãƒ¬ãƒ™ãƒ«ãªã© -->
    <section class="footer">
      <div class="chip">ãƒ¬ãƒ™ãƒ« <span id="v-level">1</span></div>
      <div class="chip">ã‘ã„ã‘ã‚“ã¡ <span id="v-xp">0</span>/<span id="v-next">30</span></div>
      <div class="chip">ãƒ¢ãƒ¼ãƒ‰ï¼š<span id="v-mode">æ˜¼</span></div>
    </section>

    <p class="note">
      ã‚ãã³ã‹ãŸï¼šã‚¹ãƒ©ã‚¤ãƒ ã¯æ™‚é–“ãŒãŸã¤ã¨ã€ãŠãªã‹ã‚„ã’ã‚“ããŒã¸ã‚Šã¾ã™ã€‚<br/>
      ãƒœã‚¿ãƒ³ã§ãŠã›ã‚ã—ã¦ã€ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’é«˜ããŸã‚‚ã¤ã¨ã€Œãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã€ã—ã¾ã™ã€‚<br/>
      ã€Œã­ã‚‹ã€ã¯ã‚‚ã†ã„ã¡ã©ãŠã™ã¨ ãŠãã¾ã™ã€‚å¤œã¨æ˜¼ã¯è‡ªå‹•ã§å…¥ã‚Œã‹ã‚ã‚Šã¾ã™ã€‚<br/>
      ã€Œâ¸ ä¸€æ™‚åœæ­¢ã€ã¯ã‚²ãƒ¼ãƒ ã®æ™‚é–“ã‚’æ­¢ã‚ã¾ã™ï¼ˆã‚‚ã†ä¸€åº¦ã§å†é–‹ï¼‰ã€‚
    </p>
  </main>

<script>
  "use strict";

  /* ã“ã‚Œã¯ã€Œã‚¹ãƒ©ã‚¤ãƒ ã‚’ãã ã¦ã‚‹ã‚²ãƒ¼ãƒ ã€ã§ã™ã€‚
     ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ã§ã‚²ãƒ¼ãƒ ã®æ™‚é–“ã®é€²ã¿ã‚’æ­¢ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ */

  const SAVE_KEY = "pixelpet_slime_v2_pause";

  /* ã‚¹ãƒ©ã‚¤ãƒ ã®ä»Šã®çŠ¶æ…‹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ */
  const state = {
    hunger: 70,
    energy: 70,
    clean:  70,
    fun:    70,
    level:  1,
    xp:     0,
    nextXP: 30,
    sleeping: false,
    isNight:  false,
    paused:   false,  /* â† ãƒãƒ¼ã‚ºä¸­ã‹ã©ã†ã‹ */
    tick: 0
  };

  function byId(id){ return document.getElementById(id); }

  function vibrate(ms){ if(navigator.vibrate){ navigator.vibrate(ms); } }

  function clamp01to100(value){
    if(value < 0){ return 0; }
    if(value > 100){ return 100; }
    return value;
  }

  function renderBars(){
    updateBar("hunger", state.hunger);
    updateBar("energy", state.energy);
    updateBar("clean",  state.clean);
    updateBar("fun",    state.fun);
  }
  function updateBar(kind, value){
    const fill = byId("bar-" + kind);
    const text = byId("v-" + kind);
    const width = String(value) + "%";
    fill.style.width = width;
    text.textContent = Math.round(value);
    fill.classList.remove("ok","warn","bad");
    if(value >= 60){ fill.classList.add("ok"); }
    else if(value >= 30){ fill.classList.add("warn"); }
    else { fill.classList.add("bad"); }
  }

  function renderLevel(){
    byId("v-level").textContent = state.level;
    byId("v-xp").textContent = state.xp;
    byId("v-next").textContent = state.nextXP;
  }

  function renderDayNight(){
    const root = document.body;
    const modeText = byId("v-mode");
    if(state.isNight){
      root.classList.add("night");
      modeText.textContent = "å¤œ";
    }else{
      root.classList.remove("night");
      modeText.textContent = "æ˜¼";
    }
  }

  function renderSlime(){
    const slime = byId("slime");
    if(state.sleeping){
      slime.classList.add("sleep");
      slime.classList.remove("face");
    }else{
      slime.classList.add("face");
      slime.classList.remove("sleep");
    }
    if(state.level >= 10){
      slime.style.width  = "240px";
      slime.style.height = "180px";
      slime.style.setProperty("--slime", "#7effaf");
    }else if(state.level >= 5){
      slime.style.width  = "210px";
      slime.style.height = "160px";
      slime.style.setProperty("--slime", "#7fb8ff");
    }else{
      slime.style.width  = "180px";
      slime.style.height = "140px";
      slime.style.setProperty("--slime", "#5bd1ff");
    }
  }

  let talkTimer = 0;
  function say(message){
    const b = byId("bubble");
    b.textContent = message;
    b.classList.add("show");
    if(talkTimer){ clearTimeout(talkTimer); }
    talkTimer = setTimeout(hideBubble, 1800);
  }
  function hideBubble(){
    const b = byId("bubble");
    b.classList.remove("show");
  }

  /* ===== ãƒœã‚¿ãƒ³ã®ã“ã†ã©ã† ===== */
  function onClickFeed(){
    if(state.paused){ return; } /* â† ãƒãƒ¼ã‚ºä¸­ã¯ä½•ã‚‚ã—ãªã„ */
    state.hunger = clamp01to100(state.hunger + 22);
    state.energy = clamp01to100(state.energy + 6);
    state.clean  = clamp01to100(state.clean  - 6);
    gainXP(6);
    renderBars();
    say("ã‚‚ãã‚‚ãï¼ãŠã„ã—ã„ï½");
    bump();
    vibrate(15);
    saveState();
  }

  function onClickPlay(){
    if(state.paused){ return; }
    state.fun    = clamp01to100(state.fun    + 20);
    state.energy = clamp01to100(state.energy - 10);
    state.clean  = clamp01to100(state.clean  - 6);
    gainXP(6);
    renderBars();
    say("ã‚ãƒ¼ã„ï¼ãŸã®ã—ã„ï¼");
    shake();
    vibrate(20);
    saveState();
  }

  function onClickBath(){
    if(state.paused){ return; }
    state.clean  = clamp01to100(state.clean  + 26);
    state.fun    = clamp01to100(state.fun    + 8);
    state.energy = clamp01to100(state.energy - 6);
    gainXP(5);
    renderBars();
    say("ãƒ”ã‚«ãƒ”ã‚«ã«ãªã£ãŸã‚ˆï¼");
    vibrate(10);
    saveState();
  }

  function onClickSleep(){
    if(state.paused){ return; }
    state.sleeping = !state.sleeping;
    const btn = byId("btn-sleep");
    if(state.sleeping){
      btn.classList.add("sleeping");
      btn.textContent = "â° ãŠãã‚‹";
      say("ãŠã‚„ã™ã¿â€¦Zzz");
    }else{
      btn.classList.remove("sleeping");
      btn.textContent = "ğŸ˜´ ã­ã‚‹";
      say("ãŠã¯ã‚ˆã†ï¼");
    }
    renderSlime();
    vibrate(8);
    saveState();
  }

  function onClickMedicine(){
    if(state.paused){ return; }
    if(canUseMedicine()){
      state.hunger = clamp01to100(state.hunger + 14);
      state.energy = clamp01to100(state.energy + 14);
      state.clean  = clamp01to100(state.clean  + 14);
      state.fun    = clamp01to100(state.fun    + 14);
      say("ã’ã‚“ããŒå‡ºã¦ããŸã‚ˆï¼");
      gainXP(4);
      renderBars();
      vibrate(10);
      saveState();
    }else{
      say("ã¾ã ã ã„ã˜ã‚‡ã†ã¶ï¼");
    }
  }
  function canUseMedicine(){
    return (state.hunger < 30 || state.energy < 30 || state.clean < 30 || state.fun < 30);
  }

  /* â¸ ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ï¼ˆæŠ¼ã™ãŸã³ã«åœæ­¢â‡„å†é–‹ï¼‰ */
  function onClickPause(){
    state.paused = !state.paused;
    updatePauseUI();
    saveState();
  }

  /* ã†ã‚Œã—ã„ã‚¸ãƒ£ãƒ³ãƒ— */
  function bump(){
    const s = byId("slime");
    s.style.transform = "translateX(-50%) translateY(-10px)";
    setTimeout(resetBump, 150);
  }
  function resetBump(){
    const s = byId("slime");
    s.style.transform = "translateX(-50%) translateY(0)";
  }

  /* ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚†ã‚‰ã™ï¼ˆéŠã‚“ã ã¨ãï¼‰ */
  function shake(){
    const stage = document.querySelector(".stage");
    stage.style.transition = "transform .08s ease";
    stage.style.transform = "translateX(3px)";
    setTimeout(shakeBack1, 80);
  }
  function shakeBack1(){
    const stage = document.querySelector(".stage");
    stage.style.transform = "translateX(-3px)";
    setTimeout(shakeBack2, 80);
  }
  function shakeBack2(){
    const stage = document.querySelector(".stage");
    stage.style.transform = "translateX(0)";
  }

  /* ===== 1ç§’ã”ã¨ã«å‹•ãã‚²ãƒ¼ãƒ ã®æ™‚é–“ ===== */

  let loopId = 0;

  function updateEverySecond(){
    /* â¸ ãƒãƒ¼ã‚ºä¸­ã¯ä½•ã‚‚ã—ãªã„ï¼ˆæ™‚é–“ãŒæ­¢ã¾ã‚‹ï¼‰ */
    if(state.paused){ return; }

    state.tick += 1;

    if(state.sleeping){
      state.energy = clamp01to100(state.energy + 2);
      state.hunger = clamp01to100(state.hunger - 1);
      state.fun    = clamp01to100(state.fun    - 1);
    }else{
      if(state.tick % 2 === 0){ state.hunger = clamp01to100(state.hunger - 2); }
      if(state.tick % 3 === 0){ state.fun    = clamp01to100(state.fun    - 2); }
      if(state.tick % 5 === 0){ state.clean  = clamp01to100(state.clean  - 1); }
      if(state.tick % 2 === 0){ state.energy = clamp01to100(state.energy - 1); }
    }

    const avg = Math.round((state.hunger + state.energy + state.clean + state.fun) / 4);
    if(avg >= 70 && state.tick % 2 === 0){ gainXP(1); }

    if(state.tick % 20 === 0){
      state.isNight = !state.isNight;
      renderDayNight();
      if(state.isNight){ say("ã‚ˆã‚‹ã«ãªã£ãŸã‚ˆ"); } else { say("ã‚ã•ã«ãªã£ãŸã‚ˆ"); }
    }

    renderBars();
    renderButtons();
    renderSlime();

    if(avg < 30 && state.tick % 4 === 0){ say("ãŠã›ã‚ã—ã¦ï½ï¼"); }
    if(state.tick % 15 === 0 && !state.sleeping){ say("ã„ã£ã—ã‚‡ã«ã‚ãã¼ï¼"); }
  }

  function gainXP(amount){
    state.xp += amount;
    while(state.xp >= state.nextXP){
      state.xp -= state.nextXP;
      levelUp();
    }
    renderLevel();
  }

  function levelUp(){
    state.level += 1;
    say("ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv." + state.level);
    state.nextXP = Math.round(state.nextXP * 1.1) + 5;
  }

  /* ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã®è¦‹ãŸç›®ã‚’æ›´æ–° */
  function renderButtons(){
    const bFeed = byId("btn-feed");
    const bPlay = byId("btn-play");
    const bBath = byId("btn-bath");
    const bSleep= byId("btn-sleep");
    const bMed  = byId("btn-med");
    const bPause= byId("btn-pause");

    /* â¸ ãƒãƒ¼ã‚ºä¸­ã¯ã€ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ä»¥å¤–ã¯ãŠã‚„ã™ã¿ */
    if(state.paused){
      bFeed.disabled = true;
      bPlay.disabled = true;
      bBath.disabled = true;
      bSleep.disabled= true;
      bMed.disabled  = true;
    }else{
      if(state.sleeping){
        bFeed.disabled = true;
        bPlay.disabled = true;
        bBath.disabled = true;
      }else{
        bFeed.disabled = false;
        bPlay.disabled = false;
        bBath.disabled = false;
      }
      bMed.disabled = !canUseMedicine();
      bSleep.disabled = false;
    }

    /* ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³ã¯å¸¸ã«æŠ¼ã›ã‚‹ï¼ˆè¡¨ç¤ºã®åˆ‡æ›¿ã ã‘ï¼‰ */
    bPause.disabled = false;
  }

  /* â¸ è¦‹ãŸç›®ï¼ˆãƒœã‚¿ãƒ³æ–‡è¨€ãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ã‚’ãã‚ãˆã‚‹ */
  function updatePauseUI(){
    const bPause = byId("btn-pause");
    const overlay = byId("pauseOverlay");
    if(state.paused){
      bPause.textContent = "â–¶ å†é–‹";
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
      say("ã‚²ãƒ¼ãƒ ã‚’ä¸€æ™‚åœæ­¢ä¸­");
    }else{
      bPause.textContent = "â¸ ä¸€æ™‚åœæ­¢";
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      say("ã‚²ãƒ¼ãƒ ã‚’å†é–‹ï¼");
    }
    renderButtons();
  }

  /* ===== ã‚»ãƒ¼ãƒ–ï¼†ãƒ­ãƒ¼ãƒ‰ ===== */

  function saveState(){
    const data = JSON.stringify(state);
    try{ localStorage.setItem(SAVE_KEY, data); }catch(err){}
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(SAVE_KEY);
      if(!raw){ return false; }
      const d = JSON.parse(raw);
      state.hunger   = clamp01to100(Number(d.hunger||70));
      state.energy   = clamp01to100(Number(d.energy||70));
      state.clean    = clamp01to100(Number(d.clean||70));
      state.fun      = clamp01to100(Number(d.fun||70));
      state.level    = Math.max(1, Number(d.level||1));
      state.xp       = Math.max(0, Number(d.xp||0));
      state.nextXP   = Math.max(10, Number(d.nextXP||30));
      state.sleeping = Boolean(d.sleeping||false);
      state.isNight  = Boolean(d.isNight||false);
      state.paused   = Boolean(d.paused||false); /* â† ä»¥å‰ã®çŠ¶æ…‹ã‚’å¾©å…ƒ */
      state.tick     = 0;
      return true;
    }catch(err){
      return false;
    }
  }

  /* ===== ã‚¤ãƒ™ãƒ³ãƒˆæº–å‚™ï¼†èµ·å‹• ===== */

  function bindEvents(){
    byId("btn-feed").addEventListener("click", onClickFeed);
    byId("btn-play").addEventListener("click", onClickPlay);
    byId("btn-bath").addEventListener("click", onClickBath);
    byId("btn-sleep").addEventListener("click", onClickSleep);
    byId("btn-med").addEventListener("click", onClickMedicine);
    byId("btn-pause").addEventListener("click", onClickPause);
  }

  function startGame(){
    const loaded = loadState();
    if(!loaded){ say("ã“ã‚“ã«ã¡ã¯ï¼ã¼ãã¯ã‚¹ãƒ©ã‚¤ãƒ ã ã‚ˆï¼"); } else { say("ãŠã‹ãˆã‚Šï¼"); }

    renderBars();
    renderLevel();
    renderDayNight();
    renderSlime();
    updatePauseUI(); /* â† ä¿å­˜ã•ã‚Œã¦ã„ãŸãƒãƒ¼ã‚ºçŠ¶æ…‹ã‚‚è¦‹ãŸç›®ã«åæ˜  */
    renderButtons();

    loopId = setInterval(updateEverySecond, 1000);
  }

  bindEvents();
  startGame();
</script>
</body>
</html>
