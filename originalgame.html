<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ãƒ”ã‚¯ã‚»ãƒ«ãƒšãƒƒãƒˆâ˜†ã‚¹ãƒ©ã‚¤ãƒ è‚²æˆï¼ˆç¨®é¡ãˆã‚‰ã¹ã‚‹ç‰ˆï¼‰</title>
<style>
  :root{
    --bg-sky:#a9d6ff;
    --bg-sky-night:#1a2240;
    --bg-ground:#6bb36b;
    --ui-dark:#222;
    --ui-light:#f7f7fb;
  }
  body{
    margin:0;
    font-family: ui-rounded, system-ui, -apple-system, "Segoe UI",
      "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    background: linear-gradient(var(--bg-sky), var(--bg-sky) 60%, var(--bg-ground) 60%, var(--bg-ground));
    min-height:100svh;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#1b1b1b;
  }
  .box{
    width:min(860px, 96vw);
    background:var(--ui-light);
    border:4px solid #3d3d3d;
    border-radius:16px;
    box-shadow:8px 8px 0 rgba(0,0,0,.25);
    padding:16px;
  }
  h1{ text-align:center; }

  /* ã‚¹ãƒ©ã‚¤ãƒ ã®è¦‹ãŸç›® */
  .slime{
    position:absolute; left:50%; bottom:20px; transform:translateX(-50%);
    width:180px; height:140px;
    border-radius:120px 120px 60px 60px;
    border:4px solid #2b6aa8;
    box-shadow: 0 8px 0 rgba(0,0,0,.2) inset;
    transition:transform .2s ease;
  }
  .slime.face::after{
    content:"â—   â—\A  ï¼¿";
    white-space: pre; font-weight:700;
    position:absolute; top:38%; left:50%; transform:translateX(-50%);
    text-align:center; font-size:22px;
  }

  .stage{ position:relative; border:3px solid #333; border-radius:12px; height:280px; background:#dff7ff; }

  .bubble{
    position:absolute; left:50%; top:18px; transform:translateX(-50%);
    background:white; color:#222; border:3px solid #333;
    border-radius:8px; padding:8px 12px; font-weight:700;
    box-shadow:4px 4px 0 rgba(0,0,0,.25);
    opacity:0; transition:opacity .25s ease; pointer-events:none;
  }
  .bubble.show{ opacity:1; }

  .controls{ display:grid; grid-template-columns: repeat(2,1fr); gap:10px; margin-top:10px; }
  .btn{ border:3px solid #333; border-radius:10px; padding:10px; font-weight:700; background:white; }

  /* é¸æŠç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  #selectScreen{
    text-align:center;
  }
  .slime-choice{
    display:inline-block; width:80px; height:70px; border:3px solid #333;
    border-radius:50%; margin:10px; cursor:pointer;
  }
  .blue{ background:#5bd1ff; }
  .green{ background:#7effaf; }
  .red{ background:#ff7b7b; }
</style>
</head>
<body>
<main class="box" id="game">
  <h1>ãƒ”ã‚¯ã‚»ãƒ«ãƒšãƒƒãƒˆ â˜† ã‚¹ãƒ©ã‚¤ãƒ è‚²æˆ</h1>

  <!-- ã‚¹ãƒ©ã‚¤ãƒ ã‚’ãˆã‚‰ã¶ç”»é¢ -->
  <section id="selectScreen">
    <p>ã©ã®ã‚¹ãƒ©ã‚¤ãƒ ã‚’è‚²ã¦ã‚‹ï¼Ÿ</p>
    <div>
      <div class="slime-choice blue" data-type="blue" title="ã‚ãŠã‚¹ãƒ©ã‚¤ãƒ "></div>
      <div class="slime-choice green" data-type="green" title="ã¿ã©ã‚Šã‚¹ãƒ©ã‚¤ãƒ "></div>
      <div class="slime-choice red" data-type="red" title="ã‚ã‹ã‚¹ãƒ©ã‚¤ãƒ "></div>
    </div>
    <p style="font-size:14px;">â€»ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¯ã˜ã‚ã‚ˆã†</p>
  </section>

  <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
  <section id="mainGame" style="display:none;">
    <section class="stage">
      <div id="slime" class="slime face"></div>
      <div id="bubble" class="bubble">ã“ã‚“ã«ã¡ã¯ï¼</div>
    </section>
    <section class="controls">
      <button id="btn-feed" class="btn">ğŸ½ ã”ã¯ã‚“</button>
      <button id="btn-play" class="btn">ğŸ² ã‚ãã¶</button>
    </section>
  </section>
</main>

<script>
"use strict";

/* ã“ã“ã§ã¯ã€Œã‚¹ãƒ©ã‚¤ãƒ ã®ç¨®é¡ã‚’ãˆã‚‰ã¹ã‚‹ã€ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
   å°å­¦ç”Ÿã§ã‚‚ã‚ã‹ã‚‹ã‚ˆã†ã«ã€å‹•ãã‚’èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚ */

/* --- ã‚²ãƒ¼ãƒ ã«ä½¿ã†å¤‰æ•° --- */
const SAVE_KEY = "pixelpet_slime_v3";

/* ã‚¹ãƒ©ã‚¤ãƒ ã®çŠ¶æ…‹ï¼ˆã“ã†ã’ã‚“ã¡ãƒ»ã’ã‚“ããªã©ï¼‰ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®å…¥ã‚Œã‚‚ã® */
const state = {
  type: "blue",   // ã‚¹ãƒ©ã‚¤ãƒ ã®ç¨®é¡ï¼ˆblue / green / redï¼‰
  hunger: 70,
  fun: 70
};

/* ãƒšãƒ¼ã‚¸å†…ã®å ´æ‰€ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®é–¢æ•° */
function byId(id){
  return document.getElementById(id);
}

/* ãƒãƒ–ãƒ«ï¼ˆãµãã ã—ï¼‰ã«è¨€è‘‰ã‚’å‡ºã™é–¢æ•° */
let talkTimer = 0;
function say(message){
  const b = byId("bubble");
  b.textContent = message;
  b.classList.add("show");
  if(talkTimer){ clearTimeout(talkTimer); }
  talkTimer = setTimeout(hideBubble, 1800);
}
function hideBubble(){
  const b = byId("bubble");
  b.classList.remove("show");
}

/* --- ã‚¹ãƒ©ã‚¤ãƒ ã®è‰²ã‚’å¤‰ãˆã‚‹é–¢æ•° --- */
function setSlimeColor(){
  const s = byId("slime");
  if(state.type === "blue"){ s.style.background = "#5bd1ff"; }
  if(state.type === "green"){ s.style.background = "#7effaf"; }
  if(state.type === "red"){ s.style.background = "#ff7b7b"; }
}

/* --- ã”ã¯ã‚“ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã --- */
function onClickFeed(){
  state.hunger += 10;
  if(state.hunger > 100){ state.hunger = 100; }
  say("ã‚‚ãã‚‚ãï¼ãŠã„ã—ã„ï½ (" + state.hunger + ")");
}

/* --- ã‚ãã¶ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã --- */
function onClickPlay(){
  state.fun += 10;
  if(state.fun > 100){ state.fun = 100; }
  say("ãŸã®ã—ã„ã­ï¼ (" + state.fun + ")");
}

/* --- ã‚¹ãƒ©ã‚¤ãƒ ã®é¸æŠç”»é¢ --- */
function bindSelectScreen(){
  const choices = document.getElementsByClassName("slime-choice");
  for(let i=0; i<choices.length; i++){
    choices[i].addEventListener("click", function(){
      state.type = this.getAttribute("data-type");
      saveState();
      startGame();
    });
  }
}

/* --- ã‚¹ãƒ©ã‚¤ãƒ ã‚’è¡¨ç¤ºã—ã¦ã‚²ãƒ¼ãƒ ã‚’ã¯ã˜ã‚ã‚‹ --- */
function startGame(){
  byId("selectScreen").style.display = "none";
  byId("mainGame").style.display = "block";
  setSlimeColor();
  say("ã“ã‚“ã«ã¡ã¯ï¼ã¼ãã¯" + state.type + "ã‚¹ãƒ©ã‚¤ãƒ ã ã‚ˆï¼");
  byId("btn-feed").addEventListener("click", onClickFeed);
  byId("btn-play").addEventListener("click", onClickPlay);
}

/* --- ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒ¼ãƒ–ã™ã‚‹ --- */
function saveState(){
  try{
    localStorage.setItem(SAVE_KEY, JSON.stringify(state));
  }catch(e){}
}

/* --- ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ˆã¿ã“ã‚€ --- */
function loadState(){
  try{
    const raw = localStorage.getItem(SAVE_KEY);
    if(!raw){ return false; }
    const data = JSON.parse(raw);
    if(data.type){ state.type = data.type; }
    return true;
  }catch(e){ return false; }
}

/* ãƒšãƒ¼ã‚¸ãŒã²ã‚‰ã‹ã‚ŒãŸã¨ãã®å‹•ã */
function init(){
  const loaded = loadState();
  bindSelectScreen();
  if(loaded){
    // ã™ã§ã«ã‚¹ãƒ©ã‚¤ãƒ ã‚’ãˆã‚‰ã‚“ã§ã„ãŸã‚‰ã€ãã®ã¾ã¾å†é–‹
    startGame();
  }
}

init();
</script>
</body>
</html>
